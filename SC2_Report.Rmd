---
title: "Using ABC to Infer Parameters of a Simulated Zombie Epidemic"
author: "Henry Bourne, Emma Tarmey, Rachel Wood"
output: 
  pdf_document:
    keep_tex: yes
date: "June 2023"
header-includes:
- \usepackage{tikz}
- \usepackage{fvextra}
- \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      dev = 'pdf',
                      pdf.options(encoding = "ISOLatin9.enc"),
                      message = FALSE,
                      warning = FALSE,
                      tidy.opts = list(width.cutoff=50), tidy=TRUE,
                      fig.pos ="H", out.width = '60%',
                      fig.align = 'center'
                      )
library(ggplot2)
library(intractmodelinf)
theme_set(theme_bw())
```

# The REVISIT package 

\textbf{Need to create a package with appropriate folders and documentation - am happy to start on this}

## Documentation

## Integration of R and C++

## Simulations

```{r}
# ----- Working Examples -----

# Replace source call with install.github() and library calls when package is finished!
# install.github("https://github.com/RaspberryEmma/Intractable-Models-Sim-Study")
# library(intractmodelinf)

source("intractmodelinf/R/generate_data.R")
suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
  library(knitr)
  library(tidyverse)
})

bristol.uni.N <- 29434
bristol.N     <- 467099
UK.N          <- 67081234

bristol.uni.example <- generate.SZR.data(N     = bristol.uni.N,
                                         initial.inf = 10,
                                         total.T     = 150)

bristol.example <- generate.SZR.data(N     = bristol.N,
                                     initial.inf = 10,
                                     total.T     = 150)

UK.example <- generate.SZR.data(N     = UK.N,
                                initial.inf = 10,
                                total.T     = 150)

bristol.example %>% head() %>% knitr::kable()


# ----- Save Data -----

write.csv( bristol.uni.example, file = "data/bristol_uni_example.csv", row.names = FALSE )
write.csv( bristol.example,     file = "data/bristol_example.csv", row.names = FALSE )
write.csv( UK.example,          file = "data/UK_example.csv", row.names = FALSE )

```

## Parallelisation

# Generating SZR data

```{r, include=FALSE}
source("intractmodelinf/R/generate_data.R")
```

We simulate the zombie epidemic using the `generate.SIR.data()` function, which is given by the code below. For ease, this function has also been included in our `intractmodelinf` package.

We use this to simulate an outbreak for 3 different populations of different sizes:

- Students (\textbf{REVISIT} and staff?) at the University of Bristol
- Residents in the city of Bristol
- Residents in the UK

The data on these simulated outbreaks is included in our package

```{r}
bristol.N     <-5000
new.example <- generate.SZR.data(N= bristol.N,
                  initial.inf = 10,
                  total.T     = 50)
#write.csv(new.example, file = "intractmodelinf/data/new_example.csv")
```

# Implementing ABC

# Checking Results

```{r, eval = FALSE}
#bristol.uni.example <- read.csv("data/bristol_uni_example.csv", header = TRUE)
#bristol.example     <- read.csv("data/bristol_example.csv", header = TRUE)
#UK.example          <- read.csv("data/UK_example.csv", header = TRUE)

legend.colors <- c("Susceptible" = "red", "Zombies" = "blue", "Removed" = "green")
source(file = "intractmodelinf/R/plots.R")

plot.SZR(new.example$results)
```
```{r}

```


```{r}
# source("intractmodelinf/R/RcppExports.R")
abc(new.example, 10, 2)
```
