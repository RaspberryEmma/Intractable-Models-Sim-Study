---
title: "Using ABC to Infer Parameters of a Simulated Zombie Epidemic"
author: "Henry Bourne, Emma Tarmey, Rachel Wood"
output: 
  pdf_document:
    df_print: paged
    keep_tex: yes
date: "June 2023"
header-includes:
- \usepackage{tikz}
- \usepackage{fvextra}
- \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      dev = 'pdf',
                      pdf.options(encoding = "ISOLatin9.enc"),
                      message = FALSE,
                      warning = FALSE,
                      tidy.opts = list(width.cutoff=50), tidy=TRUE,
                      fig.pos ="H", out.width = '60%',
                      fig.align = 'center'
                      )
library(ggplot2)

library(devtools)
library(ZombieSim)
theme_set(theme_bw())
```

# The REVISIT package 

\textbf{Need to create a package with appropriate folders and documentation - am happy to start on this}

## Documentation

## Integration of R and C++

## Simulations

## Parallelisation

# Generating SZR data
We simulate the zombie epidemic using the `generate.SIR.data()` function, which is given by the code below. For ease, this function has also been included in our `intractmodelinf` package.

We use this to simulate an outbreak for 3 different populations of different sizes:

- Students (\textbf{REVISIT} and staff?) at the University of Bristol
- Residents in the city of Bristol
- Residents in the UK

The data on these simulated outbreaks is included in our package

```{r}
N     <-5000
initial <- generateStartCond(N, initial.inf = 10)

new.example <- generateSZRdata(initial ,total.T     = 50)
#write.csv(new.example, file = "data/new_example.csv")
```

# Implementing ABC

# Checking Results

```{r, eval}
#bristol.uni.example <- read.csv("data/bristol_uni_example.csv", header = TRUE)
#bristol.example     <- read.csv("data/bristol_example.csv", header = TRUE)
#UK.example          <- read.csv("data/UK_example.csv", header = TRUE)

legend.colors <- c("Susceptible" = "red", "Zombies" = "blue", "Removed" = "green")
source(file = "intractmodelinf/R/plots.R")

plot.SZR(new.example$results)
```




```{r}
simulated.mat <- new.example$results
simulated.mat  <- as.matrix(simulated.mat[,2:4])
head(simulated.mat )
priorMin <- c(0.0        , 0.0001, 0.0        , 0.00009, 0.0049) 
priorMax <- c(0.000000001, 0.00095 , 0.000000001, 0.0001 , 0.005 )
res <- abcRej(simulated.mat , 1000, 1000, priorMin, priorMax)
head(res)
```

```{r, message=FALSE}
library(ggplot2)
library(dplyr)

means <- c(new.example$beta, new.example$kappa, new.example$rho)
samples <- res[,2:4] %>%
  as_tibble()
colnames(samples) <- c("beta", "kappa", "rho")  

plots <- plot.posterior.samples(samples, means)
plots[[1]]
```

